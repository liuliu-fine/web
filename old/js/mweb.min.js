function msg(e){0==j("#msg").length&&j("body").append('<div id="msg" class="msg"></div>'),j("#msg").hide(),j("#msg").html(e),j("#msg").fadeIn(800,function(){setTimeout("j('#msg').fadeOut(400)",800)})}function titlebar(e,t){var o=3;o=1==t?3:0;var n=12-2*o;if(j("#titlebar").length>0)j("body").remove();else{var i="";i+='<div id="titlebar" class="nav navbar-fixed-top titlebar">',o>0&&(i+='      <div class="col-xs-'+o+' text-left">&nbsp;&nbsp;<a href="javascript:history.back();"><i class="iconfont pink">&#xe60a;</i></a></div>'),i+='      <h4 class="col-xs-'+n+'">'+e+"</h4>",i+="</div>",j("body").append(i)}j("div.container:first").css({"margin-top":"40px"})}function rest(e,t,o){var n=arguments[3],i={};i.method=e,i.data=JSON.stringify(t),i.version="1.0.0",i.rnd=Math.random(),j.ajax({type:"post",async:!0,url:CONTEXT+"/rest.do",contentType:"application/x-www-form-urlencoded; charset=utf-8",data:i,dataType:"json",cache:!1,beforeSend:function(e){e.setRequestHeader("If-Modified-Since","0"),e.setRequestHeader("Cache-Control","no-cache")},success:function(e){null!=o&&(0==e.RESULT_CODE?403e3==e.RESULT_DATA.code?(j.cookie("token",null,{expires:0,path:"/"}),localStorage.removeItem("token"),n||(location.href="login.vhtml")):(o(e),j(".loader-bg").hide(),j("#total").show()):msg(e.RESULT_DATA.ERROR_TITLE))},error:function(){msg("系统请求错误!")}})}function identify(){rest("membership.identify.get",{shopId:SHOPID},function(e){if(200==e.RESULT_DATA.code){var t=e.RESULT_DATA.result;if(null!=t.code){for(var o=0;o<t.code;o++)j("#no"+o).html(t.code.charAt(o));j("#alert").modal()}}})}function submit(e,t){var o=j("#input").val();""==o?msg("手机号码不能为空！"):/^\s*1\d{10}\s*$/.test(o)?rest(t,{phone:o,id:e},function(e){200==e.RESULT_DATA.code?window.location.href="finish.vhtml":msg(e.RESULT_DATA.message)}):msg("请正确填写手机号码！")}function exchange(e){var t=e.split("&");j("#count").html(t[0]),j("#exchange").modal({relatedTarget:this,onConfirm:function(e){rest("benefit.exchange.post",{shopId:SHOPID,activityId:t[1],ruleId:t[2]},function(e){200==e.RESULT_DATA.code?(j("#my-confirm").modal(),j("#my-confirm .am-modal-btn:first").click(function(){location.reload()})):window.location.href="login.vhtml"})}})}function getCounpon(e){rest("benefit.coupon.post",{activityId:e.attr("id"),shopId:SHOPID},function(t){200==t.RESULT_DATA.code?j("#my-confirm").modal({relatedTarget:this,onConfirm:function(){window.location="power.vhtml"},onCancel:function(){e.addClass("am-disabled")}}):(e.addClass("am-disabled"),msg(t.RESULT_DATA.message))})}function cancel(){rest("check.cancel.post",{shopId:SHOPID},function(){j.cookie("table_id","",{expires:0,path:"/"}),j.cookie("table_time","",{expires:0,path:"/"}),j.cookie("check_id","",{expires:0,path:"/"}),location.href="index.vhtml"})}