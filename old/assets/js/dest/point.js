j(function(){var e=decodeURIComponent(window.location.search.substr(1));e=e.split("&"),j("#img").attr("src","/mweb/assets/i/"+e[2]+".svg"),j("#title").html(e[1]),j("#modal-confirm").load("/mweb/modal.html"),j("#charge").click(function(){identify()}),j("body").on("click",".getCoupon",function(){getCounpon(j(this))}),rest("activity.get",{activityId:e[0],shopId:SHOPID},function(e){if(200==e.RESULT_DATA.code){var t=e.RESULT_DATA.result,i={COUPONFREE:"送券",CHARGE:"充值",DISCOUNT:"打折",SPECIAL_PRICE:"特价",COUPON:"消费返券",POINT:"积分",POINTCONSUME:"积分抵现",CHARGECONSUME:"充值卡使用"};if(null!=t.get)for(var a in t.get){if(j("#am-name").text(i[t.get[0].activityCategory]),"COUPONFREE"==t.get[0].activityCategory&&(j("#getCoupon").show(),j("#getCoupon").find(".getCoupon").attr("id",t.get[0].activityId)),"CHARGECONSUME"!=t.get[0].activityCategory&&"CHARGE"!=t.get[0].activityCategory||(j("#getCharge").show(),j("#getCharge").find("button").attr("id",t.get[0].activityId)),null!=t.get[a].periods?j("#periods").html(j("#periods").html().replace("@periods@",t.get[a].periods)):j("#periods").hide(),null!=t.get[a].shared?j("#shared").html(j("#shared").html().replace("@shared@",t.get[a].shared)):j("#shared").hide(),null!=t.get[a].shops?j("#shops").html(j("#shops").html().replace("@shops@",t.get[a].shops)):j("#shops").hide(),null!=t.get[a].time?j("#time").html(j("#time").html().replace("@time@",t.get[a].time)):j("#time").hide(),null!=t.get[a].nonParticipations?j("#nonParticipations").html(j("#nonParticipations").html().replace("@nonParticipations@",t.get[a].nonParticipations)):j("#nonParticipations").hide(),null!=t.get[a].limit){var n="";for(var r in t.get[a].limit){var l=j("#limit-content").html();l=l.replace("@limit@",t.get[a].limit[r]),n+=l}j("#limit-content").html(n)}else j("#limit").hide();var o="";for(var s in t.get[a].strategy){var c=j("#activity-title").html();c=c.replace("@class@",t.get[a].strategy[s].name);var m="",p=t.get[a].strategy[s].details;for(var h in p){var d=j("#activity-content").html();if(null!=p[h].content){var u="";for(var g in p[h].content){var v=j("#list-name").html();v=v.replace("@content@",p[h].content[g]),u+=v}d=d.replace(j("#list-name").html(),u)}var f="";if(null!=p[h].coupons)for(var g in p[h].coupons){var y=p[h].coupons[g],C="";"901"==y.category&&(C=j("#tmp-coupon-charge").html(),C=C.replace("@@name@@",y.name),C=C.replace("@@effectTimes@@",y.effectTimes),C=C.replace("@id@","couponShow.vhtml?"+y.id)),"902"==y.category&&(C=j("#tmp-coupon-consume").html(),C=C.replace("@@name@@",y.name),C=C.replace("@@amount@@",y.amount),C=C.replace("@@currentAmount@@",y.currentAmount?"￥"+y.currentAmount:"免费"),C=C.replace("@@effectTimes@@",y.effectTimes),C=C.replace("@id@","couponShow.vhtml?"+y.id)),f+=C}d=d.replace(j("#coupon").html(),f),m+=d}c=c.replace(j("#activity-content").html(),m),o+=c}j("#activity-title").html(o)}else j("#get").hide();if(null!=t.used)for(var a in t.used){if(j("#am-name1").text(i[t.used[0].activityCategory]),null!=t.used[a].periods?j("#periods1").html(j("#periods1").html().replace("@periods@",t.used[a].periods)):j("#periods1").hide(),null!=t.used[a].shared?j("#shared1").html(j("#shared1").html().replace("@shared@",t.used[a].shared)):j("#shared1").hide(),null!=t.used[a].shops?j("#shops1").html(j("#shops1").html().replace("@shops@",t.used[a].shops)):j("#shops1").hide(),null!=t.used[a].time?j("#time1").html(j("#time1").html().replace("@time@",t.used[a].time)):j("#time1").hide(),null!=t.used[a].nonParticipations?j("#nonParticipations1").html(j("#nonParticipations1").html().replace("@nonParticipations@",t.used[a].nonParticipations)):j("#nonParticipations1").hide(),null!=t.used[a].limit){var P="";for(var r in t.used[a].limit){var A=j("#limit-content1").html();A=A.replace("@limit@",t.used[a].limit[r]),P+=A}j("#limit-content1").html(P)}else j("#limit1").hide();var E="";for(var s in t.used[a].strategy){var T=j("#activity-title1").html();T=T.replace("@class@",t.used[a].strategy[s].name);var O="";for(var h in t.used[a].strategy[s].details){var I=j("#activity-content1").html(),u="";if(null!=t.used[a].strategy[s].details[h].content)for(var R in t.used[a].strategy[s].details[h].content){var v=j("#list-name1").html();v=v.replace("@content@",t.used[a].strategy[s].details[h].content[R]),u+=v}I=I.replace(j("#list-name1").html(),u);var f="";if(null!=t.used[a].strategy[s].details[h].coupons)for(var g in t.used[a].strategy[s].details[h].coupons){var y=t.used[a].strategy[s].details[h].coupons[g],C="";"901"==y.category?(C=j("#tmp-coupon-charge").html(),C=C.replace("@@name@@",y.name),C=C.replace("@@effectTimes@@",y.effectTimes)):"902"==y.category&&(C=j("#tmp-coupon-consume").html(),C=C.replace("@@name@@",y.name),C=C.replace("@@amount@@",y.amount),C=C.replace("@@currentAmount@@",y.currentAmount?"￥"+y.currentAmount:"免费"),C=C.replace("@@effectTimes@@",y.effectTimes)),f+=C}I=I.replace("@coupon@",f),O+=I,T=T.replace(j("#activity-content1").html(),O),E+=T}}j("#activity-title1").html(E)}else j("#used").hide()}})});