function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition,function(){msg("定位失败.")},{enableHighAccuracy:!0}):msg("设备不支持定位.")}function showPosition(e){var o=[121.429313,31.253051],t={shopId:SHOPID,tableNo:j("#table").val(),latitude:o[1],longitude:o[0]};rest("check.post",t,function(e){if(200==e.RESULT_DATA.code){var o=new Date;j.cookie("table_id",j("#table").val(),{path:"/"}),j.cookie("table_time",o.getHours()+":"+o.getMinutes()+":"+o.getSeconds(),{path:"/"}),j.cookie("check_id",e.RESULT_DATA.result.id,{path:"/"}),location.href="payRequest.vhtml"}else msg(e.RESULT_DATA.message),403007!=e.RESULT_DATA.code&&403005!=e.RESULT_DATA.code||j("#payment").parent().html('<div class="am-margin-bottom-sm">'+e.RESULT_DATA.message+'</div><button class="am-u-sm-10 am-u-sm-offset-1 am-btn am-radius am-disabled bg-grey text-white" id="payment">一键智付 </button>')})}var query=window.location.search.substr(1);"vip"==query&&j(".coupon").html("已领券"),j("header").append('<div class=\'am-header-right am-header-nav\'><a href="index.vhtml"><span style="background: #5099e8;padding: 5px;" class="border-radius text-white am-text-xs am-padding-horizontal-xs"><i class="iconfont">&#xe602;</i>进店看看</span></a></div>'),""!=TOKEN&&null!=TOKEN&&"null"!=TOKEN||(location.href="index.vhtml"),j("#payment").click(function(){j("#table").val()?showPosition():msg("桌号不能为空")}),j.cookie("table_id")&&(j("#out").hide(),j("#in").show()),rest("benefit.get",{shopId:SHOPID},function(e){if(200==e.RESULT_DATA.code){var o=e.RESULT_DATA.result;j.cookie("relationId",o.relationId,{expires:30,path:"/"}),null!=o.memberCardNo&&j("#member-info").hide(),null!=o.memberCardNo?(j("#member-info").show(),j("#member-uninfo").hide()):o.existMemberRule?(j("#member-info").hide(),j("#member-uninfo").show()):j("#top").hide(),j("#section-coupon").show(),j("#member-grade-name").html(o.memberGradeName),j("#member-card-no").html(o.memberCardNo),j("#member-charge").html("￥"+o.charge),j("#remainder").attr("href","remainder.vhtml?"+o.charge),j("#point").attr("href","pointRecord.vhtml?"+o.point),j("#member-point").html(o.point),o.couponCount>0&&j("#member-coupon-count").html(o.couponCount);var t="";null==o.coupon&&j("#coupon-list").html(j("#img").html());for(var a in o.coupon){var n=o.coupon[a],i="";"901"==n.category&&(i=j("#tmp-coupon-charge").html(),i=i.replace("@@name@@",n.name),i=i.replace("@@startTime@@",n.startTime),i=i.replace("@@endTime@@",n.endTime),i=i.replace("@id@","couponShow.vhtml#"+n.id)),"902"==n.category&&(i=j("#tmp-coupon-consume").html(),i=i.replace("@@name@@",n.name),i=i.replace("@@amount@@",n.amount),i=i.replace("@@currentAmount@@",n.currentAmount?"￥"+n.currentAmount+".0":"免费"),i=i.replace("@@startTime@@",n.startTime),i=i.replace("@@endTime@@",n.endTime),i=i.replace("@id@","couponShow.vhtml#"+n.id)),t+=i}j("#coupon-list").append(t)}else{if(""==TOKEN||null==TOKEN||"null"==TOKEN)return void(location.href="index.vhtml");j("#my-popup").modal(),j("#top").hide(),j(".bg-grey-white.border").hide(),j("#middle").hide(),j("#img").show()}});