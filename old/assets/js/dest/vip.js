j(function(){j("#modal-alert").load("/mweb/modal.html"),j("body").on("click",".login",function(){window.location.href="login.vhtml"}),j("body").on("click",".identify",function(){identify()}),j("body").on("click",".free",function(){var t=j(this);t.attr("id");rest("membership.post",{shopId:SHOPID},function(e){200==e.RESULT_DATA.code?j("#my-confirm").modal({relatedTarget:this,onConfirm:function(){window.location="power.vhtml"},onCancel:function(){t.addClass("am-disabled")}}):msg("领取失败")})}),rest("membership.rules.get",{shopId:SHOPID},function(t){if(200==t.RESULT_DATA.code){var e=t.RESULT_DATA.result;if(null==e)j(".title-ing").hide(),j("#total").hide();else{var a="";for(var n in e){var l="",m=j("#vip").html();if(m=m.replace("@@title@@",e[n].toName),null==e[n].ruleText)j("#special").hide();else{for(var s in e[n].ruleText){var i=j("#activity-name").html();i=i.replace("@@name@@",e[n].ruleText[s].name),i=i.replace("@@time@@",e[n].ruleText[s].time),l+=i}m=m.replace(j("#activity-name").html(),l)}if(null==e[n].strategy)m=m.replace(j("#upgrade").html(),""),m=m.replace(j("#rule").html(),"");else{var o="";for(var r in e[n].strategy){var c="",u=e[n].strategy[r].type,b=j("#upgrade").html();if(b=b.replace("@@upgrade-name@@",e[n].strategy[r].content),""==TOKEN||null==TOKEN||"null"==TOKEN){var d={FREE:"领卡",BUY:"购买",CHARGE:"充值",POINT_EXCHANGE:"兑换"};c="POINT"==u?"":"<button class='am-btn am-btn-xs am-u-sm-offset-2 am-u-sm-10 btn login'>"+d[u]+"</button>"}else switch(u){case"FREE":c="<button class='am-btn am-btn-xs am-disabled am-u-sm-offset-2 am-u-sm-10 btn free'>领卡</button>";break;case"BUY":c="<button class='am-btn am-btn-xs am-disabled am-u-sm-offset-2 am-u-sm-10 btn identify'>购买</button>";break;case"CHARGE":c="<button class='am-btn am-btn-xs am-disabled am-u-sm-offset-2 am-u-sm-10 btn identify'>充值</button>";break;case"POINT_EXCHANGE":c="<button class='am-btn am-btn-xs am-disabled am-u-sm-offset-2 am-u-sm-10 btn exchange_button' onclick='exchange(\""+e[n].strategy[r].amount+"&"+e[n].strategy[r].activityId+"&"+e[n].strategy[r].ruleId+"\")'>兑换</button>"}e[n].strategy[r].usable&&(c=c.replace("am-disabled","")),b=b.replace(j("#button").html(),c),o+=b}m=m.replace(j("#upgrade").html(),o)}a+=m}j("#vip").html(a)}}else window.location.href="login.vhtml"})});